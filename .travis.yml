language: python
cache:
  directories:
    - $HOME/.ccache
sudo: required
virtualenv:
  system_site_packages: true
notifications:
  email:
    on_success: always
    on_failure: always
  slack: jsk-robotics:Av7tc8wj3IWkLYvlTzHE7x2g
env:
  global:
    - ROSWS=wstool
    - BUILDER=catkin
    - USE_TRAVIS=true
    - ROS_PARALLEL_JOBS="-j2"
    - CATKIN_PARALLEL_JOBS="-p2"
    - ROS_PARALLEL_TEST_JOBS="-j4"
    - CATKIN_PARALLEL_TEST_JOBS="-p1"
    - NOT_TEST_INSTALL=true
matrix:
  fast_finish: true
  include:
    - dist: precise
      env: ROS_DISTRO=hydro  USE_DEB=false  CATKIN_TOOLS_BUILD_OPTIONS="-iv --summarize --limit-status-rate 0.002"
    - dist: trusty
      env: ROS_DISTRO=indigo USE_DEB=true  CATKIN_TOOLS_BUILD_OPTIONS="--summarize --limit-status-rate 0.002"
    - dist: trusty
      env: ROS_DISTRO=indigo USE_DEB=false  CATKIN_TOOLS_BUILD_OPTIONS="--summarize --limit-status-rate 0.002"
    - dist: trusty
      env: ROS_DISTRO=jade USE_DEB=true  CATKIN_TOOLS_BUILD_OPTIONS="--summarize --limit-status-rate 0.002"
    - dist: trusty
      env: ROS_DISTRO=jade USE_DEB=false  CATKIN_TOOLS_BUILD_OPTIONS="--summarize --limit-status-rate 0.002"
  allow_failures:
    - dist: trusty
      env: ROS_DISTRO=jade USE_DEB=true  CATKIN_TOOLS_BUILD_OPTIONS="--summarize --limit-status-rate 0.002"
    - dist: trusty
      env: ROS_DISTRO=jade USE_DEB=false  CATKIN_TOOLS_BUILD_OPTIONS="--summarize --limit-status-rate 0.002"
install:
  # create another virtualenv to avoid https://github.com/travis-ci/travis-ci/issues/4948
  - deactivate
  - virtualenv --system-site-packages rosbuild
  - source rosbuild/bin/activate
before_script:
  - export EXTRA_DEB="ros-$ROS_DISTRO-convex-decomposition ros-$ROS_DISTRO-ivcon"
script: source .travis/travis.sh
