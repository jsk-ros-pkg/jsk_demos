<launch>
  <arg name="MACHINE" default="c2"/>
  <arg name="MANAGER" default="extract_eng2_forum_door_point_cloud_nodelet_manager"/>
  <arg name="INPUT_INFO" default="/kinect_head/rgb/camera_info"/>
  <arg name="INPUT_CLOUD" default="/kinect_head/depth_registered/points"/>

  <group ns="extract_eng2_forum_door_point_cloud">

    <node name="$(arg MANAGER)"
          pkg="nodelet" type="nodelet"
          args="manager"
          machine="$(arg MACHINE)"
          output="screen"
          respawn="true">
    </node>

    <!-- Launch pipeline to extract point cloud of forum door region in eng2. -->
    <!-- This pipeline is useful to check if the door is open. -->

    <node name="bounding_box_array_publisher"
          pkg="jsk_recognition_utils" type="bounding_box_array_publisher.py"
          machine="$(arg MACHINE)">
      <rosparam>
        frame_id: /eng2/2f
        boxes:
          - position: [10.5, -27.0, 1.0]
            rotation: [0.0, 0.0, 0.0]
            dimension: [0.6, 1.4, 1.8]
            label: 0
        rate: 10.0
      </rosparam>
    </node>

    <node name="bbox_array_to_bbox"
          pkg="nodelet" type="nodelet"
          args="load jsk_pcl_utils/BoundingBoxArrayToBoundingBox $(arg MANAGER)"
          machine="$(arg MACHINE)"
          output="screen"
          respawn="true">
      <remap from="~input" to="bounding_box_array_publisher/output"/>
      <rosparam>
        index: 0
      </rosparam>
    </node>

    <node name="attention_clipper"
          pkg="nodelet" type="nodelet"
          args="load jsk_pcl/AttentionClipper $(arg MANAGER)"
          machine="$(arg MACHINE)"
          output="screen"
          respawn="true">
      <remap from="~input" to="$(arg INPUT_INFO)"/>
      <remap from="~input/points" to="$(arg INPUT_CLOUD)"/>
      <remap from="~input/box" to="bbox_array_to_bbox/output"/>
    </node>

    <node name="extract_indices"
          pkg="nodelet" type="nodelet"
          args="load jsk_pcl/ExtractIndices $(arg MANAGER)"
          machine="$(arg MACHINE)"
          output="screen"
          respawn="true">
      <remap from="~input" to="$(arg INPUT_CLOUD)"/>
      <remap from="~indices" to="attention_clipper/output/point_indices"/>
      <rosparam>
        keep_organized: false
        approximate_sync: true
        max_queue_size: 100
      </rosparam>
    </node>

  </group>

</launch>
