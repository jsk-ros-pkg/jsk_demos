<launch>
  <arg name="MANAGER" default="/kinect_head/kinect_head_c2_nodelet_manager"/>
  <arg name="DOOR_CONFIG_FILE" default="$(find elevator_move_base_pr2)/config/door_bboxes.yaml"/>
  <arg name="CAMERA_INFO" default="/kinect_head/rgb/camera_info"/>
  <arg name="INPUT_CLOUD" default="/kinect_head/depth_registered/half/throttled/points"/>

  <group ns="forum_door">

    <!-- Launch pipeline to extract point cloud of door region. -->
    <!-- This pipeline is useful to check if the door is open. -->
    <node name="transformable_interactive_server"
          pkg="jsk_interactive_marker" type="transformable_server_sample"
          output="screen"
          respawn="true">
      <rosparam>
        display_interactive_manipulator: true
        display_interactive_manipulator_only_selected: true
        display_description_only_selected: true
      </rosparam>
    </node>
    <node name="transformable_door_markers"
          pkg="jsk_interactive_marker" type="transformable_markers_client.py"
          output="screen"
          respawn="true">
      <remap from="~server" to="transformable_interactive_server"/>
      <rosparam subst_value="true">
        config_file: $(arg DOOR_CONFIG_FILE)
        config_auto_save: true
      </rosparam>
    </node>

    <!-- Extract forum door region. -->
    <node name="bbox_array_to_bbox"
          pkg="nodelet" type="nodelet"
          args="load jsk_pcl_utils/BoundingBoxArrayToBoundingBox $(arg MANAGER)"
          output="screen"
          respawn="true">
      <remap from="~input" to="transformable_door_markers/output/boxes"/>
      <rosparam>
        index: 0  <!-- name: forum_door -->
      </rosparam>
    </node>
    <node name="attention_clipper"
          pkg="nodelet" type="nodelet"
          args="load jsk_pcl/AttentionClipper $(arg MANAGER)"
          output="screen"
          respawn="true">
      <remap from="~input" to="$(arg CAMERA_INFO)"/>
      <remap from="~input/points" to="$(arg INPUT_CLOUD)"/>
      <remap from="~input/box" to="bbox_array_to_bbox/output"/>
    </node>
    <node name="extract_indices"
          pkg="nodelet" type="nodelet"
          args="load jsk_pcl/ExtractIndices $(arg MANAGER)"
          output="screen"
          respawn="true">
      <remap from="~input" to="$(arg INPUT_CLOUD)"/>
      <remap from="~indices" to="attention_clipper/output/point_indices"/>
      <rosparam>
        keep_organized: false
        approximate_sync: true
        max_queue_size: 100
      </rosparam>
    </node>

  </group>

</launch>
